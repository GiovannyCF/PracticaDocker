<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Estudiantes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-5">

    <h1 class="text-center mb-4">Microservicio Estudiantes</h1>

    <div class="row">
        <div class="col-md-4">
            <div class="card">
                <div class="card-header bg-primary text-white">Registrar Estudiante</div>
                <div class="card-body">
                    <form id="formEstudiante">
                        <div class="mb-3">
                            <label>Cédula (CI)</label>
                            <input type="text" id="ci" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label>Nombre</label>
                            <input type="text" id="nombre" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label>Apellido</label>
                            <input type="text" id="apellido" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label>Celular</label>
                            <input type="text" id="celular" class="form-control" required>
                        </div>
                        <button type="submit" class="btn btn-success w-100">Guardar</button>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-8">
            <h3>Lista de Estudiantes</h3>
            <button onclick="cargarEstudiantes()" class="btn btn-info mb-2 text-white">Actualizar Lista</button>
            <table class="table table-striped table-bordered">
                <thead class="table-dark">
                    <tr>
                        <th>ID</th>
                        <th>CI</th>
                        <th>Nombre Completo</th>
                        <th>Celular</th>
                        <th>Estado</th>
                    </tr>
                </thead>
                <tbody id="tablaCuerpo">
                    </tbody>
            </table>
        </div>
    </div>

    <script>
        const API_URL = "http://localhost:8080/api/Estudiantes";

        async function cargarEstudiantes() {
            try {
                const response = await fetch(`${API_URL}/Listar`);
                const datos = await response.json();
                
                const cuerpo = document.getElementById("tablaCuerpo");
                cuerpo.innerHTML = "";

                datos.forEach(est => {
                    cuerpo.innerHTML += `
                        <tr>
                            <td>${est.id}</td>
                            <td>${est.ci}</td>
                            <td>${est.nombre} ${est.apellido}</td>
                            <td>${est.celular}</td>
                            <td><span class="badge bg-secondary">${est.estado}</span></td>
                        </tr>
                    `;
                });
            } catch (error) {
                console.error("Error cargando estudiantes:", error);
                alert("Error al conectar con el microservicio. Revisa la consola.");
            }
        }

        document.getElementById("formEstudiante").addEventListener("submit", async (e) => {
            e.preventDefault();

            const nuevoEstudiante = {
                ci: document.getElementById("ci").value,
                nombre: document.getElementById("nombre").value,
                apellido: document.getElementById("apellido").value,
                celular: document.getElementById("celular").value,
                estado: "Activo"
            };

            try {
                const response = await fetch(`${API_URL}/Insert`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(nuevoEstudiante)
                });

                if (response.ok) {
                    alert("¡Estudiante registrado con éxito!");
                    document.getElementById("formEstudiante").reset();
                    cargarEstudiantes();
                } else {
                    const errorMsg = await response.text();
                    alert("Error: " + errorMsg);
                }
            } catch (error) {
                console.error("Error al registrar:", error);
                alert("No se pudo registrar. ¿Está corriendo Docker?");
            }
        });
        cargarEstudiantes();
    </script>
</body>
</html>